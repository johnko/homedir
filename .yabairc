#!/usr/bin/env sh

# set layout to bsp (managed), other options are float (unmanaged) or stack (layered fullscreen)
yabai -m config layout bsp

# grid format is <rows>:<cols>:<start-x>:<start-y>:<width>:<height>
# float tall center halfwide for web
yabai -m rule --add app="^(Google Chrome)$" manage=off grid=101:4:1:0:2:100
# right half, fulltall
yabai -m rule --add app="^(Brave Browser)$" manage=off grid=101:4:1:0:2:97
# float tall
yabai -m rule --add app="^(Clock|Gmail|System Preferences|System Settings)$" manage=off grid=24:24:5:1:14:22
# float tall wide 16/24 of screen for editing
yabai -m rule --add app="^(Books|GarageBand|GIMP|iMovie|Photos)$" manage=off grid=24:24:4:2:16:20
# float tall wide 18/24 of screen for focus
yabai -m rule --add app="^(Xcode)$" manage=off grid=24:24:3:3:18:21
# float tall wide 20/24 of screen for video
yabai -m rule --add app="^(TV)$" manage=off grid=24:24:2:4:20:19

# float middle center quarter
yabai -m rule --add app="^(1Password|FaceTime|Finder|Keychain Access|Photo Booth|QuickTime.*|TextEdit)$" manage=off grid=4:4:1:1:2:2
# float bottom center quarter
yabai -m rule --add app="^(Activity Monitor|App Store|Contacts|Dictionary|Voice Memos)$" manage=off grid=4:4:1:2:2:2
# float bottom center 2/3
yabai -m rule --add app="^(Calendar|Disk Utility|Find My|Home|Maps|News|Shortcuts|Stocks|System Information|Weather)$" manage=off grid=12:12:3:4:6:8

# right half, fulltall
yabai -m rule --add app="^(Console|GitHub|Google Drive|Preview)$" manage=off grid=101:52:26:0:25:100

# top right quarter screen
yabai -m rule --add app="^(LuLu)$" manage=off grid=101:52:26:0:25:50
# bottom left quarter screen
yabai -m rule --add app="^(UTM)$" manage=off grid=101:52:1:50:25:50
# bottom right quarter screen
yabai -m rule --add app="^(Netiquette)$" manage=off grid=101:52:26:50:25:50

# float top middle <0.5 tall
yabai -m rule --add app="^(Google Calendar|Notes|Reminders)$" manage=off grid=8:4:1:0:2:3

# bottom left 1, halftall quarterwide right on vertical screen
yabai -m rule --add app="^(Signal)$" manage=off grid=101:52:0:50:13:50
# bottom left 2, halftall quarterwide right on vertical screen
yabai -m rule --add app="^(LINE)$" manage=off grid=101:52:13:50:13:50
# bottom right 1, halftall quarterwide right on vertical screen
yabai -m rule --add app="^(Messages)$" manage=off grid=101:52:26:50:13:50
# bottom right 2, halftall quarterwide right on vertical screen
yabai -m rule --add app="^(Firefox|Spotify)$" manage=off grid=101:52:39:50:13:50
# middle 3/4tall quarterwide right on vertical screen
# 101:52:13:40:26:56
# 101:52:14:40:24:56
# 101:52:15:40:22:56
# 101:52:16:40:20:56
# 101:52:17:40:18:56
# 101:52:18:40:16:56
# 101:52:19:40:14:56
yabai -m rule --add app="^(Instagram|WhatsApp.*)$" manage=off grid=101:52:19:40:14:56

# float don't block widgets left
yabai -m rule --add app="^(Slack)$" manage=off grid=101:52:5:9:23:91
# float don't block widgets right
yabai -m rule --add app="^(Safari)$" manage=off grid=101:52:28:9:23:91

# right above-middle, less than halfwide
yabai -m rule --add app="^(Discord)$" manage=off grid=101:52:32:40:20:49
yabai -m rule --add app="^(Netflix)$" manage=off grid=101:52:32:40:20:56
# right above-middle, less than halfwide tall
yabai -m rule --add app="^(Crunchyroll.*)$" manage=off grid=103:52:34:18:18:80

# bottom right <0.5 tall
yabai -m rule --add app="^(Docker.*|Podman.*|Music|Podcasts)$" manage=off grid=8:4:1:0:2:3

# Terminal specific so can swap - float middle center quarter
# yabai -m rule --add app="^(Terminal)$" manage=off grid=4:4:1:1:2:2
# Terminal specific so can swap - almost fullscreen
# yabai -m rule --add app="^(Terminal)$" manage=off grid=52:52:1:1:50:50
# Terminal specific so can swap - left 1/4 wide, 3/4 tall
yabai -m rule --add app="^(Terminal)$" manage=off grid=101:52:1:25:25:75
# bottom right 3/4 wide, 3/4 tall
yabai -m rule --add app="^(Code|Cursor)$" manage=off grid=101:52:17:25:34:75

# Coding grid
# top left
yabai -m rule --add app="^(Code|Cursor|Terminal)$" title="^.*(6)$" manage=off grid=101:52:1:0:25:50
# top right
yabai -m rule --add app="^(Code|Cursor|Terminal)$" title="^.*(7)$" manage=off grid=101:52:26:0:25:50
# middle center
yabai -m rule --add app="^(Code|Cursor|Terminal)$" title="^.*(0)$" manage=off grid=4:4:1:1:2:2
# bottom left
yabai -m rule --add app="^(Code|Cursor|Terminal)$" title="^.*(8)$" manage=off grid=101:52:1:50:25:50
# bottom right
yabai -m rule --add app="^(Code|Cursor|Terminal)$" title="^.*(9)$" manage=off grid=101:52:26:50:25:50
# left/right split
yabai -m rule --add app="^(Terminal)$" title="^.*(2|3|4|5)$" manage=off grid=101:52:1:0:25:100
yabai -m rule --add app="^(Code|Cursor)$" title="^.*(2|3|4|5)$" manage=off grid=101:52:17:0:34:100


# float some non-resizable apps
yabai -m rule --add app="^(iPhone Mirroring)$" manage=off

# default to float centered
# cat .yabairc | grep -v grep | grep -v '^ *#' | grep app= | cut -d= -f2 | sed -e 's,manage,,' -e 's, title,,g' -e 's, $,,g' | grep -v noexist | tr -d '"^$)(' | tr '|' "\n" | sort -u | tr "\n" '|' | sed -e 's, |,|,g' -e 's,|$,,' | pbcopy
yabai -m rule --add app!="^(1Password|Activity Monitor|App Store|Books|Brave Browser|Calendar|Clock|Code|Console|Contacts|Crunchyroll.*|Cursor|Dictionary|Discord|Disk Utility|Docker.*|FaceTime|Find My|Finder|Firefox|GarageBand|GIMP|GitHub|Gmail|Google Calendar|Google Chrome|Google Drive|Home|iMovie|Instagram|iPhone Mirroring|Keychain Access|LINE|LuLu|Maps|Messages|Music|Netflix|Netiquette|News|Notes|Photo Booth|Photos|Podcasts|Podman.*|Preview|QuickTime.*|Reminders|Safari|Shortcuts|Signal|Slack|Spotify|Stocks|System Information|System Preferences|System Settings|Terminal|TextEdit|TV|UTM|Voice Memos|Weather|WhatsApp.*|Xcode)$" manage=off grid=4:4:1:1:2:2

# apply rules on restart
yabai -m rule --apply
# balance resize windows after rules applied
yabai -m space --balance
