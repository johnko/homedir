#!/usr/bin/env sh

#####################################################################
# grid format is <rows>:<cols>:<start-x>:<start-y>:<width>:<height>
#####################################################################

yabai -m rule --add app="^(Activity Monitor)$" manage=on
yabai -m rule --add app="^(App Store)$" manage=on
yabai -m rule --add app="^(Calendar)$" manage=on
yabai -m rule --add app="^(Clock)$" manage=on
yabai -m rule --add app="^(Console)$" manage=on
yabai -m rule --add app="^(Contacts)$" manage=on
yabai -m rule --add app="^(Dictionary)$" manage=on
yabai -m rule --add app="^(Disk Utility)$" manage=on
yabai -m rule --add app="^(FaceTime)$" manage=on
yabai -m rule --add app="^(Find My)$" manage=on
yabai -m rule --add app="^(Finder)$" manage=on
yabai -m rule --add app="^(GitHub)$" manage=on
yabai -m rule --add app="^(Gmail)$" manage=on
yabai -m rule --add app="^(Google Chrome)$" manage=on
yabai -m rule --add app="^(Google Drive)$" manage=on
yabai -m rule --add app="^(Home)$" manage=on
yabai -m rule --add app="^(Instagram)$" manage=on
yabai -m rule --add app="^(LINE)$" manage=on
yabai -m rule --add app="^(Maps)$" manage=on
yabai -m rule --add app="^(Messages)$" manage=on
yabai -m rule --add app="^(News)$" manage=on
yabai -m rule --add app="^(Notes)$" manage=on
yabai -m rule --add app="^(Reminders)$" manage=on
yabai -m rule --add app="^(Safari)$" manage=on
yabai -m rule --add app="^(Shortcuts)$" manage=on
yabai -m rule --add app="^(Signal)$" manage=on
yabai -m rule --add app="^(Slack)$" manage=on
yabai -m rule --add app="^(Stocks)$" manage=on
yabai -m rule --add app="^(System Information)$" manage=on
yabai -m rule --add app="^(System Preferences|System Settings)$" manage=on
yabai -m rule --add app="^(TextEdit)$" manage=on
yabai -m rule --add app="^(Voice Memos)$" manage=on
yabai -m rule --add app="^(Weather)$" manage=on
yabai -m rule --add app="^(WhatsApp.*)$" manage=on

# float fullscreen grid=1:1:0:0:1:1
yabai -m rule --add app="^(Crunchyroll.*)$" manage=off grid=1:1:0:0:1:1
yabai -m rule --add app="^(GarageBand)$" manage=off grid=1:1:0:0:1:1
yabai -m rule --add app="^(GIMP)$" manage=off grid=1:1:0:0:1:1
yabai -m rule --add app="^(iMovie)$" manage=off grid=1:1:0:0:1:1
yabai -m rule --add app="^(Netflix)$" manage=off grid=1:1:0:0:1:1
yabai -m rule --add app="^(Photos)$" manage=off grid=1:1:0:0:1:1

# float 1/4 or 3/4
yabai -m rule --add app="^(Terminal)$" manage=off grid=1:4:0:0:1:1 #100:10:0:0:3:91
yabai -m rule --add app="^(Code)$" manage=off grid=1:4:1:0:3:1 #100:10:3:0:6:91
yabai -m rule --add app="^(Cursor)$" manage=off grid=1:4:0:0:3:1 #100:10:0:0:6:91
yabai -m rule --add app="^(Xcode)$" manage=off grid=1:4:0:0:3:1 #100:10:0:0:6:91

# float top left quarter screen grid=2:4:0:0:1:1
yabai -m rule --add app="^(Firefox)$" manage=off grid=2:4:0:0:1:1
yabai -m rule --add app="^(Spotify)$" manage=off grid=2:4:0:0:1:1

# float centre half screen grid=1:4:1:0:2:1
yabai -m rule --add app="^(Books)$" manage=off grid=1:4:1:0:2:1
yabai -m rule --add app="^(Brave Browser)$" title!="^.*( Tab).*$" manage=off grid=1:4:1:0:2:1
yabai -m rule --add app="^(Brave Browser)$" title="^.*( Tab).*$" manage=on
yabai -m rule --add app="^(Preview)$" manage=off grid=1:4:1:0:2:1

# float middle center quarter grid=4:4:1:1:2:2
yabai -m rule --add app="^(1Password)$" manage=off grid=4:4:1:1:2:2
yabai -m rule --add app="^(Keychain Access)$" manage=off grid=4:4:1:1:2:2
yabai -m rule --add app="^(Photo Booth)$" manage=off grid=4:4:1:1:2:2
yabai -m rule --add app="^(QuickTime.*)$" manage=off grid=4:4:1:1:2:2

# float bottom left quarter screen grid=2:4:0:1:1:1
yabai -m rule --add app="^(Docker.*)$" manage=off grid=2:4:0:1:1:1
yabai -m rule --add app="^(Music)$" manage=off grid=2:4:0:1:1:1
yabai -m rule --add app="^(Podcasts)$" manage=off grid=2:4:0:1:1:1
yabai -m rule --add app="^(Podman.*)$" manage=off grid=2:4:0:1:1:1
yabai -m rule --add app="^(UTM)$" manage=off grid=2:4:0:1:1:1

# float bottom right half screen grid=2:4:2:1:2:1
yabai -m rule --add app="^(Netiquette)$" manage=off grid=2:4:2:1:2:1

# float right half screen grid=1:2:1:0:1:1
yabai -m rule --add app="^(Discord)$" manage=off grid=1:2:1:0:1:1
yabai -m rule --add app="^(LuLu)$" manage=off grid=1:2:1:0:1:1

# float bottom 3/4 screen grid=4:4:0:1:3:3
yabai -m rule --add app="^(Google Calendar)$" manage=off grid=4:4:0:1:3:3

# float some non-resizable apps
yabai -m rule --add app="^(iPhone Mirroring)$" manage=off

# default to float centered
# cat .yabairc | grep -v grep | grep -v '^ *#' | grep app= | tr -d '!' | cut -d= -f2 | sed -e 's,manage,,' -e 's, title,,g' -e 's, $,,g' | grep -v noexist | tr -d '"^$)(' | tr '|' "\n" | sort -u | tr "\n" '|' | sed -e 's, |,|,g' -e 's,|$,,' | pbcopy
# yabai -m rule --add app!="^(1Password|Activity Monitor|App Store|Books|Brave Browser|Calendar|Clock|Code|Console|Contacts|Crunchyroll.*|Cursor|Discord|Disk Utility|Docker.*|FaceTime|Finder|Firefox|GarageBand|GIMP|GitHub|Gmail|Google Calendar|Google Chrome|Google Drive|iMovie|Instagram|iPhone Mirroring|Keychain Access|LINE|LuLu|Messages|Music|Netflix|Netiquette|NO_APP_1|NO_APP_2|NO_APP_3|NO_APP_4|NO_APP_5|Notes|Photo Booth|Photos|Podcasts|Podman.*|Preview|QuickTime.*|Reminders|Safari|Signal|Slack|Spotify|System Preferences|System Settings|Terminal|TextEdit|UTM|WhatsApp.*|Xcode)$" manage=off grid=8:4:1:3:2:4

yabai -m config window_gap 15
yabai -m config window_origin_display default
yabai -m config window_placement second_child
yabai -m config window_insertion_point last
yabai -m config split_type vertical
yabai -m config auto_balance on

# refresh yabai when display disconnect/reconnect
yabai -m signal --add event=display_added action="yabai --restart-service"
yabai -m signal --add event=display_removed action="yabai --restart-service"
yabai -m signal --add event=display_resized action="yabai --restart-service"

yabai -m config top_padding 0
yabai -m config bottom_padding 190
yabai -m config left_padding 0
yabai -m config right_padding 370

# apply rules on restart
yabai -m rule --apply

# now set padding to not block widgets on 4k monitor
# it's after applying rules so that original rule grid is preserved
# yabai -m config top_padding 0
# yabai -m config bottom_padding 190
# yabai -m config left_padding 0
# yabai -m config right_padding 370

# set layout to bsp (managed), other options are float (unmanaged) or stack (layered fullscreen)
yabai -m config layout bsp

# border red active, transparent inactive
borders active_color=0xffff0000 inactive_color=0x00888888 width=15.0 &
